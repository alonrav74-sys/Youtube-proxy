<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ChordFinderPro v14.36 ğŸµ</title>
  
  <style>
    :root{--bg:#0b1022;--panel:#0f172a;--muted:#94a3b8;--text:#e5e7eb;--card:#0a1324;--border:#1b2333;--brand:#22c55e;--accent:#38bdf8;--alert:#f59e0b}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(160deg,var(--bg),#0a0f1c);font-family:system-ui;color:var(--text);direction:rtl;padding:20px}
    h1{font-size:24px;margin-bottom:20px}
    .panel{background:#0c162b;border:1px solid #1f2a40;border-radius:16px;padding:20px;margin-top:16px}
    button{padding:12px 20px;border-radius:12px;border:1px solid #223;background:#22c55e;color:#000;font-weight:700;cursor:pointer;font-size:14px}
    input[type="file"]{padding:10px;border-radius:12px;border:1px solid #223;background:#0b1221;color:#cfe3ff}
    .status{padding:12px;border-radius:8px;margin-top:12px;font-size:14px}
    .ok{background:#0d2e1f;border:1px solid #22c55e;color:#d7ffe6}
    .err{background:#3f1d1d;border:1px solid #5f2323;color:#ffe0e0}
  </style>
</head>
<body>

<h1>ğŸµ Chord Finder Pro v14.36</h1>

<div class="panel">
  <input id="file" type="file" accept="audio/*" />
  <button id="analyzeBtn" style="margin-top:12px">× ×ª×—</button>
  <div id="status" class="status" style="display:none"></div>
</div>

<div class="panel">
  <h3>×ª×•×¦××•×ª</h3>
  <pre id="output" style="color:#a0e0ff;font-family:monospace;font-size:12px;line-height:1.4">×××ª×™×Ÿ ×œ× ×™×ª×•×—...</pre>
</div>

<script src="BassEngine_ENHANCED.js"></script>
<script src="MajorMinorRefiner_AGGRESSIVE.js"></script>
<script src="ChordEngine_ULTIMATE_v2.js"></script>

<script>
let engine;

window.addEventListener('DOMContentLoaded', () => {
  if (typeof ChordEngineEnhanced === 'undefined') {
    document.getElementById('status').textContent = 'âŒ ChordEngine_ULTIMATE_v2.js ×œ× × ×˜×¢×Ÿ! ×•×“× ×©×”×§×‘×¦×™× ×‘×ª×™×§×™×™×”.';
    document.getElementById('status').className = 'status err';
    document.getElementById('status').style.display = 'block';
    return;
  }
  
  engine = new ChordEngineEnhanced();
  console.log('âœ… Engine loaded successfully!');
  console.log('  BassEngine:', typeof BassEngine !== 'undefined' ? 'âœ…' : 'âŒ');
  console.log('  MajorMinorRefiner:', typeof MajorMinorRefiner !== 'undefined' ? 'âœ…' : 'âŒ');
});

document.getElementById('analyzeBtn').onclick = async () => {
  const fileEl = document.getElementById('file');
  const statusEl = document.getElementById('status');
  const outputEl = document.getElementById('output');
  
  if (!fileEl.files[0]) {
    statusEl.textContent = 'âš ï¸ ×‘×—×¨ ×§×•×‘×¥';
    statusEl.className = 'status err';
    statusEl.style.display = 'block';
    return;
  }
  
  try {
    statusEl.textContent = 'ğŸ”„ ×× ×ª×—...';
    statusEl.className = 'status ok';
    statusEl.style.display = 'block';
    
    // Decode audio
    const file = fileEl.files[0];
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const arrayBuffer = await file.arrayBuffer();
    const audioBuffer = await ctx.decodeAudioData(arrayBuffer);
    
    // Detect chords
    const result = await engine.detect(audioBuffer, {
      useBassEngine: true,
      useMajorMinorRefiner: true,
      minConfidenceToOverride: 0.40,
      decisionThreshold: 0.15,
      debug: true
    });
    
    // Display results
    const NOTES = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
    let output = `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n`;
    output += `âœ… × ×™×ª×•×— ×”×•×©×œ×!\n`;
    output += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
    output += `×¡×•×œ×: ${NOTES[result.key.root]} ${result.key.minor ? 'minor' : 'major'}\n`;
    output += `××§×•×¨×“×™×: ${result.chords.length}\n\n`;
    
    if (result.chords.some(c => c.refinedBy === 'MajorMinorRefiner')) {
      const corrections = result.chords.filter(c => c.refinedBy === 'MajorMinorRefiner').length;
      output += `ğŸµ MajorMinorRefiner: ${corrections} ×ª×™×§×•× ×™×\n\n`;
      output += `×ª×™×§×•× ×™×:\n`;
      result.chords.filter(c => c.refinedBy === 'MajorMinorRefiner').forEach(c => {
        output += `  ${c.t.toFixed(1)}s: ${c.originalLabel} â†’ ${c.label}\n`;
      });
    }
    
    output += `\n10 ××§×•×¨×“×™× ×¨××©×•× ×™×:\n`;
    result.chords.slice(0, 10).forEach((c, i) => {
      output += `${i+1}. ${c.label} @ ${c.t.toFixed(1)}s\n`;
    });
    
    outputEl.textContent = output;
    statusEl.textContent = 'âœ… ×”×¦×œ×—×”!';
    
  } catch (e) {
    console.error(e);
    statusEl.textContent = 'âŒ ×©×’×™××”: ' + e.message;
    statusEl.className = 'status err';
  }
};
</script>

</body>
</html>
